<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>박지은 아파트 구매계산기 2.0</title>
  <style>
    :root {
      /* 2025 Light + Liquid Glass */
      --bg:#f6f5f2;
      --bg-2:#f0eee8;
      --panel:rgba(255,255,255,0.65);
      --muted:#5a6775;
      --fg:#0b0f15;
      --accent:#0a84ff;   /* Apple Blue */
      --accent-2:#64d2ff; /* Sky/Teal */
      --good:#2e7d32;
      --bad:#c62828;
      --warn:#b26a00;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 24px; background:
        radial-gradient(900px 500px at 5% -10%, rgba(10,132,255,0.12), transparent),
        radial-gradient(800px 500px at 110% 0%, rgba(100,210,255,0.14), transparent),
        radial-gradient(700px 400px at 50% 110%, rgba(255,180,120,0.10), transparent),
        conic-gradient(from 180deg at 50% 10%, rgba(10,132,255,0.05), rgba(100,210,255,0.05), rgba(255,180,120,0.06), rgba(180,120,255,0.06), rgba(10,132,255,0.05)),
        linear-gradient(180deg, var(--bg), #ffffff);
      color: var(--fg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Apple SD Gothic Neo, Helvetica, Arial, sans-serif;
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; line-height: 1.65;
    }
    h1 { font-size: 24px; margin: 0 0 8px; letter-spacing: 0.2px; }
    p.lead { margin: 0 0 18px; color: var(--muted); }
    .container { display: grid; grid-template-columns: 1.2fr 1fr; gap: 20px; align-items: start; }
    .card { background: var(--panel); border: 1px solid rgba(11,15,21,0.06); border-radius: 16px; padding: 18px 16px 14px; backdrop-filter: blur(14px) saturate(150%);
      box-shadow: 0 10px 30px rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.35);
    }
    .card h2 { font-size: 17px; margin: 0 0 12px; color: #0b0f15; }
    .grid { display: grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 12px; }
    .grid-3 { display: grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap: 10px; }
    label { display: block; font-size: 13px; color: var(--muted); margin: 2px 0 6px; }
    input, select { width: 100%; padding: 12px 12px; background: rgba(255,255,255,0.75); color: var(--fg);
      border: 1px solid rgba(11,15,21,0.12); border-radius: 12px; outline: none; line-height: 1.5; backdrop-filter: blur(6px);
    }
    input::placeholder { color: #7a8896; }
    select { cursor: pointer; }
    input:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(56,189,248,0.15); }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .muted { color: var(--muted); font-size: 12.5px; }
    .pill { display: inline-block; padding: 2px 8px; border-radius: 999px; font-size: 12px; border: 1px solid rgba(148,163,184,0.25); color:#cbd5e1; }
    .pill.good { border-color: rgba(16,185,129,0.5); color:#a7f3d0; }
    .pill.bad { border-color: rgba(239,68,68,0.5); color:#fecaca; }
    .value { font-weight: 700; font-size: 20px; }
    .kicker { font-size: 11px; color: var(--muted); margin-left: 0; }
    hr.sep { border: none; height: 1px; background: rgba(148,163,184,0.15); margin: 10px 0; }
    .small { font-size: 12px; color: var(--muted); }
    .highlight { color: var(--accent-2); }
    .em { color: var(--accent); }
    .flex { display:flex; gap:10px; align-items:center; flex-wrap: wrap; }
    .btn { background: linear-gradient(135deg, var(--accent), var(--accent-2)); color:#ffffff; font-weight:700; border:none; border-radius:12px; padding:10px 12px; cursor:pointer; box-shadow: 0 6px 20px rgba(10,132,255,0.25); }
    .btn:active { transform: translateY(1px); }
    .note { font-size: 12px; color: #cbd5e1; }
    .hero { display:flex; align-items:center; justify-content:space-between; padding: 12px 14px; border:1px solid rgba(11,15,21,0.08); border-radius: 14px; background: linear-gradient(180deg, rgba(10,132,255,0.10), rgba(100,210,255,0.10)); margin-bottom: 12px; backdrop-filter: blur(8px) saturate(120%); }
    .subhead { font-size: 16px; font-weight: 800; color: var(--fg); margin: 14px 0 8px; letter-spacing: 0.2px; }
    .note-inline { font-size: 11px; color: var(--muted); }
    .tooltip { position: relative; display: inline-flex; align-items: center; gap: 4px; }
    .tooltip .tip { position: absolute; left: 50%; transform: translateX(-50%); bottom: calc(100% + 8px); background: rgba(0,0,0,0.85); color: #fff; padding: 6px 8px; border-radius: 8px; white-space: nowrap; font-size: 11px; opacity: 0; pointer-events: none; transition: opacity .15s ease; }
    .tooltip:hover .tip { opacity: 1; }
    .hero .title { font-size: 13px; color: var(--muted); }
    .hero .amount { font-size: 24px; font-weight: 800; }
    .subitems { margin-top: 6px; color: var(--muted); font-size: 12.5px; line-height: 1.5; }
     
    @media (max-width: 980px) {
      body { padding: 16px; }
      .container { grid-template-columns: 1fr; gap: 16px; }
      .grid { grid-template-columns: 1fr; }
      .card { padding: 14px; }
      h1 { font-size: 22px; }
    }
    .mono { font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; }
  </style>
</head>
<body>
  <header style="margin-bottom: 16px;">
    <h1>박지은을 위한 아파트 구매 계산기 2.0</h1>
    <p class="lead">현재 상황에 맞춰서 주택담보대출 LTV/DSR 한도, 월 상환액, 세금, 보유기간 손익을 계산해줄게. 하 만들기 힘들다</p>
<!--    <div class="small">이 도구는 간이 시뮬레이터일 뿐. 정확하지 않음.</div> -->
  </header>

  <div class="container">
    <section class="card">
      <h2>입력란</h2>
      <div class="grid">
        <div>
          <label>아파트 매매가 (만원)</label>
          <input type="text" id="price" inputmode="numeric" placeholder="예: 62,000" />
        </div>
        <div>
          <label>박지은 보유 자본 (만원)</label>
          <input type="text" id="cash" inputmode="numeric" placeholder="예: 10,000" />
        </div>

        <div>
          <label>박지은 연봉 (만원)</label>
          <input type="text" id="annualIncome" inputmode="numeric" placeholder="예: 4,500" />
        </div>
        

        <div>
          <label>대출기간 (년)</label>
          <input type="number" id="loanYears" min="1" max="40" step="1" placeholder="30" />
        </div>
        <div>
          <label>연 이자율 (%, 고정 가정)</label>
          <input type="number" id="annualRate" min="0" max="20" step="0.01" placeholder="3.9" />
        </div>

        <div>
          <label>LTV 입력 (%)</label>
          <input type="number" id="ltvManualPct" min="0" max="100" step="1" placeholder="70" value="80" />
        </div>

        <div>
          <label>DSR 한도 (%)</label>
          <input type="number" id="dsrLimitPct" min="0" max="100" step="1" placeholder="40" />
        </div>
        <div>
          <label>다른 대출 월 상환액 (만원, DSR계산을 위함)</label>
          <input type="text" id="existingMonthlyDebt" inputmode="numeric" placeholder="예: 0" />
        </div>

        <div>
          <label>공시가/시세 비율 (재산세 간이 계산용)</label>
          <input type="number" id="assessedRatioPct" min="0" max="100" step="1" placeholder="70" />
        </div>
        <div>
          <label>목표 보유 기간 (년)</label>
          <input type="number" id="holdingYears" min="1" max="40" step="1" placeholder="10" />
        </div>

        <div>
          <label>연 시세상승률 가정 (%)</label>
          <input type="number" id="annualAppreciationPct" min="-50" max="50" step="0.1" placeholder="2.5" />
        </div>
        <div>
          <label>혹은 목표 매도가 (만원, 입력안하면 평균 시세상승 적용)</label>
          <input type="text" id="targetSellPrice" inputmode="numeric" placeholder="예: 70,000" />
        </div>

        
      </div>

      <div class="flex" style="margin-top:12px;">
        <button class="btn" id="btnCalc">계산하기</button>
        <span class="note">입력값 변경 시 자동으로 갱신돼</span>
      </div>
    </section>

    <section class="card">
      <h2>계산 결과</h2>
      <div class="subhead">대출</div>
      <div class="grid">
        <div>
          <div class="muted">대출 필요액</div>
          <div class="value" id="neededLoan">-</div>
          <div class="kicker">= 매매가 − 보유자본</div>
        </div>
        <div>
          <div class="muted">적용 LTV 상한</div>
          <div class="value" id="ltvCap">-</div>
          <div class="kicker">지역 기본치, 수동 조정 가능</div>
        </div>

        <div>
          <div class="muted">DSR 허용 월상환 상한</div>
          <div class="value" id="dsrCapMonthly">-</div>
          <div class="kicker">(연소득×DSR/12) − 기존부채</div>
        </div>
        <div>
          <div class="muted">한도 내 대출 가능액</div>
          <div class="value" id="maxLoanAllowed">-</div>
          <div class="kicker">LTV/DSR 중 작은 값</div>
        </div>
        <div>
          <div class="muted">최대 대출 대비 부족 자본금 <span class="tooltip">ⓘ<span class="tip">아파트 대출 가능 금액은 실거래가 아닌 시세 기준이므로 실제 대출 가능 금액은 더 높을 수 있음</span></span></div>
          <div class="value" id="shortCapital">-</div>
          <div class="kicker">= 필요대출 − 한도내 대출</div>
        </div>

        <div style="grid-column: 1 / -1;">
          <div class="hero">
            <div class="title">예상 월 납부 원리금</div>
            <div class="amount" id="monthlyPayment">-</div>
          </div>
          <div class="subitems">
            <span>원금 평균: <span id="avgPrincipal">-</span></span>
            <span style="margin-left:12px;">이자 평균: <span id="avgInterest">-</span></span>
          </div>
        </div>
      </div>

      <hr class="sep" />
      <div class="subhead">매수 시 비용</div>
      <div>
        <div class="subitems">
          <div>· 취득세(생애최초 200만원 할인 반영): <span id="acqTax">-</span></div>
          <div>· 중개수수료(추정): <span id="brokerFee">-</span></div>
          <div>· 인지세(추정): <span id="stampTax">-</span></div>
        </div>
        <div class="hero" style="margin-top:8px;">
          <div class="title">매수 시 비용 합계</div>
          <div class="amount" id="buyCostGrandTotal">-</div>
        </div>
      </div>

      <hr class="sep" />
      <div class="subhead">보유 유지비</div>
      <div class="grid">
        <div>
          <div class="muted">연간 보유세 추정(재산세)</div>
          <div class="value" id="annualPropertyTax">-</div>
          <div class="kicker">공시가≈시세×비율, 간이누진</div>
        </div>
        <div>
          <div class="muted">보유기간 총이자(추정)</div>
          <div class="value" id="interestPaid">-</div>
          <div class="kicker">원리금균등 기준</div>
        </div>
      </div>

      <hr class="sep" />
      <div class="subhead">시세 차익</div>
      <div>
        <div class="muted">단순 시세 차익(세전)</div>
        <div class="value" id="simpleGain">-</div>
      </div>
      <div style="margin-top:8px;">
        <div class="muted">보유기간 손익(세전·취득세/부대비용 포함, 양도세 제외)</div>
        <div class="value" id="pnl">-</div>
<!--       <div class="kicker">단순 시세 차익 − (취득세+부대비용+이자)</div> -->
        <div class="subitems" style="margin-top:2px;">
          <div><span id="dbgSimpleGain">-</span> − (취득세 <span id="dbgAcq">-</span> + 부대비용 <span id="dbgBuyCost">-</span> + 이자 <span id="dbgInterest">-</span> <span class="note-inline">(<span id="dbgMonths">-</span>개월치)</span>)</div>
        </div>
      </div>
    </section>
  </div>

  <section class="card" style="margin-top:16px;">
    <h2>상세 계산</h2>
    <div class="grid-3">
      <div>
        <div class="muted">LTV 기준 최대 대출</div>
        <div class="value" id="ltvMax">-</div>
      </div>
      <div>
        <div class="muted">DSR 기준 최대 대출</div>
        <div class="value" id="dsrMax">-</div>
      </div>
      <div>
        <div class="muted">필요 대출 대비 부족/여유</div>
        <div class="value" id="gap">-</div>
      </div>
    </div>

    <hr class="sep" />
    <div class="small">
      가정 : (1) 원리금균등, 고정금리 (2) 취득세 좀 정확하지 않음. (3) 보유세: 공시가≈시세×입력비율 (4) DSR: (연소득×한도/12 − 기존 월 대출상환금)로 산정한 월상환 상한 기준. 오세용이 만듬.
    </div>
  </section>

  <script>
    // ---------- 유틸 ----------
    const nf = new Intl.NumberFormat('ko-KR');
    const MANWON = 10000;
    const EOK = 100000000; // 1억
    const cfmt = (n) => n==null||isNaN(n) ? '-' : nf.format(Math.round(n));
    const wfmt = (n) => n==null||isNaN(n) ? '-' : nf.format(Math.round(n)) + '원';
    const mfmt = (n) => n==null||isNaN(n) ? '-' : nf.format(Math.round(n / MANWON)) + '만원';
    const signedMfmt = (n) => {
      if (n==null||isNaN(n)) return '-';
      const sign = n >= 0 ? '+' : '';
      return sign + mfmt(Math.abs(n));
    };
    const eokManWonFmt = (n) => {
      if (n==null||isNaN(n)) return '-';
      const abs = Math.abs(Math.round(n));
      const eok = Math.floor(abs / EOK);
      const man = Math.floor((abs % EOK) / MANWON);
      const won = abs % MANWON;
      const parts = [];
      if (eok > 0) parts.push(`${eok}억`);
      if (man > 0) {
        // won이 있으면 '만', 없으면 '만원'
        parts.push(`${nf.format(man)}만${won > 0 ? '' : '원'}`);
      }
      if (won > 0) parts.push(`${nf.format(won)}원`);
      if (parts.length === 0) parts.push('0원');
      // 3억원 같이 딱 떨어지면 '3억원'
      if (eok > 0 && man === 0 && won === 0) return (n < 0 ? '-' : '') + `${eok}억원`;
      return (n < 0 ? '-' : '') + parts.join(' ');
    };
    const signedEokManWon = (n, showPlus) => {
      if (n==null || isNaN(n)) return '-';
      const sp = !!showPlus;
      const absStr = eokManWonFmt(Math.abs(Number(n)));
      if (n < 0) return '-' + absStr.replace(/^[-]/,'');
      return (sp ? '+' : '') + absStr;
    };
    const pfmt = (n) => n==null||isNaN(n) ? '-' : (Math.round(n*10)/10).toFixed(1) + '%';
    const valNum = (id) => parseFloat(String(document.getElementById(id).value).replace(/[^0-9.-]/g,'')) || 0;
    const toNum = (n, d=0) => {
      const x = Number(n);
      return Number.isFinite(x) ? x : d;
    };
    const setText = (id, text) => { document.getElementById(id).textContent = text; };
    const clamp = (x, lo, hi) => Math.max(lo, Math.min(hi, x));
    const manToWon = (nMan) => nMan * MANWON;
    const valManToWon = (id) => manToWon(valNum(id));

    function annuityMonthlyPayment(principal, annualRatePct, years) {
      if (!principal || principal <= 0) return 0;
      const r = (annualRatePct/100) / 12;
      const n = years * 12;
      if (r === 0) return principal / n;
      return principal * r / (1 - Math.pow(1 + r, -n));
    }

    function principalFromMonthly(payment, annualRatePct, years) {
      const r = (annualRatePct/100) / 12;
      const n = years * 12;
      if (r === 0) return payment * n;
      return payment * (1 - Math.pow(1 + r, -n)) / r;
    }

    function remainingBalance(principal, annualRatePct, years, monthsElapsed) {
      const r = (annualRatePct/100) / 12;
      const n = years * 12;
      const pmt = annuityMonthlyPayment(principal, annualRatePct, years);
      if (r === 0) return principal - (pmt * monthsElapsed);
      // Formula: B_k = P*(1+r)^k - pmt* [((1+r)^k - 1)/r]
      const pow = Math.pow(1 + r, monthsElapsed);
      return principal * pow - pmt * ((pow - 1) / r);
    }

    // ---------- 정책 가정(간이) ----------
    function ltvDefaultPct(region, homeCount) {
      // 매우 간이화: 실제 제도는 가격구간/생애최초 등 복잡. 수동 조정 전제로 기본값만 제공
      if (region === 'speculation') return 40; // 투기과열(서울 강북구 기본)
      if (region === 'adjusted') return 50;    // 조정대상
      return 70; // 일반
    }

    function acquisitionTax(price, homeCount, region) {
      // 기본: 1주택 1.1/2.2/3.3% (취득세+지방교육세 10%)
      // 다주택 중과(간이): 규제지역 2주택 8%, 3주택 이상 12% (대략)
      const priceW = price;
      let baseRate;
      if (homeCount >= 2 && (region === 'adjusted' || region === 'speculation')) {
        baseRate = (homeCount >= 3) ? 12 : 8; // 간이 가정
      } else {
        if (priceW <= 600_000_000) baseRate = 1.1;
        else if (priceW <= 900_000_000) baseRate = 2.2;
        else baseRate = 3.3;
      }
      const gross = priceW * (baseRate/100);
      // 생애최초 취득세 200만원 할인(간이 반영, 하한 0)
      const discount = 2_000_000;
      return Math.max(0, gross - discount);
    }

    function annualPropertyTaxSimple(price, assessedRatioPct) {
      // 공시가 ≈ 시세 × 비율, 누진세율(간이): 0.1% (≤6억), 0.15% (6~15억), 0.25% (15~30억), 0.4% (>30억)
      const assessed = price * (assessedRatioPct/100);
      const bands = [
        { cap: 600_000_000, rate: 0.0010 },
        { cap: 1_500_000_000, rate: 0.0015 },
        { cap: 3_000_000_000, rate: 0.0025 },
        { cap: Infinity, rate: 0.0040 },
      ];
      let remaining = assessed, prevCap = 0, tax = 0;
      for (const b of bands) {
        const taxable = Math.max(0, Math.min(remaining, b.cap - prevCap));
        tax += taxable * b.rate;
        remaining -= taxable;
        prevCap = b.cap;
        if (remaining <= 0) break;
      }
      return Math.max(0, tax);
    }

    function compute() {
      const price = valManToWon('price');
      const cash = valManToWon('cash');
      const annualIncome = valManToWon('annualIncome');
      const monthlySalaryInput = 0; // 월급 필드 제거: 연소득/12 사용
      const years = parseInt(document.getElementById('loanYears').value || '0', 10) || 0;
      const rate = parseFloat(document.getElementById('annualRate').value || '0') || 0;
      const region = 'speculation'; // 지역 규제 입력 제거: 기본 가정
      const homeCount = 0; // 무주택 가정
      const dsrLimitPct = parseFloat(document.getElementById('dsrLimitPct').value || '0') || 0;
      const existingMonthlyDebt = valManToWon('existingMonthlyDebt');
      const assessedRatioPct = parseFloat(document.getElementById('assessedRatioPct').value || '0') || 0;
      const holdingYears = parseInt(document.getElementById('holdingYears').value || '0', 10) || 0;
      const annualAppreciationPct = parseFloat(document.getElementById('annualAppreciationPct').value || '0') || 0;
      const targetSellPrice = valManToWon('targetSellPrice');
      const sellCostPct = 0; // 매도 부대비용율 제외

      // 필요 대출액
      const neededLoan = Math.max(0, toNum(price) - toNum(cash));

      // LTV 한도 (수동 입력 우선)
      const ltvManualField = document.getElementById('ltvManualPct');
      const ltvManualRaw = ltvManualField ? ltvManualField.value : '';
      const ltvManual = ltvManualRaw === '' ? NaN : parseFloat(ltvManualRaw);
      const ltvPct = isNaN(ltvManual) ? ltvDefaultPct(region, homeCount) : ltvManual;
      const ltvMax = toNum(price) * (toNum(ltvPct)/100);

      // DSR 한도: 허용 월상환 상한
      const monthlyIncome = toNum(annualIncome)/12;
      const dsrCapMonthly = Math.max(0, (toNum(annualIncome) * (toNum(dsrLimitPct)/100) / 12) - toNum(existingMonthlyDebt));
      const dsrMax = principalFromMonthly(toNum(dsrCapMonthly), toNum(rate), toNum(years));

      // 최종 대출 가능액 (필요액, LTV, DSR 중 최소)
      const maxLoanAllowed = Math.max(0, Math.min(toNum(neededLoan), toNum(ltvMax), toNum(dsrMax)));

      // 월납부액(실제 대출 실행액 기준)
      const monthlyPayment = annuityMonthlyPayment(toNum(maxLoanAllowed), toNum(rate), toNum(years));

      // 취득세
      const acqTax = acquisitionTax(toNum(price), homeCount, region);

      // 보유세(간이, 연간)
      const annualPropTax = annualPropertyTaxSimple(toNum(price), toNum(assessedRatioPct));

      // 보유기간 이자합계(원리금균등 기준)
      const monthsHeld = toNum(holdingYears) * 12;
      const monthsConsidered = Math.min(monthsHeld, toNum(years)*12);
      const totalPaidDuringHold = toNum(monthlyPayment) * monthsConsidered;
      const remainingAfterHold = remainingBalance(toNum(maxLoanAllowed), toNum(rate), toNum(years), monthsConsidered);
      const principalRepaid = Math.max(0, toNum(maxLoanAllowed) - toNum(remainingAfterHold));
      const interestPaid = Math.max(0, toNum(totalPaidDuringHold) - toNum(principalRepaid));
      const avgPrincipal = monthsConsidered > 0 ? principalRepaid / monthsConsidered : 0;
      const avgInterest = monthsConsidered > 0 ? interestPaid / monthsConsidered : 0;

      // 미래 매도가
      let projectedSellPrice = toNum(targetSellPrice) > 0 ? toNum(targetSellPrice) : toNum(price) * Math.pow(1 + (toNum(annualAppreciationPct)/100), toNum(holdingYears));
      const simpleGain = Math.max(0, toNum(projectedSellPrice) - toNum(price));

      // 매수 부대비용(간이): 중개수수료 + 인지세
      const brokerFee = (() => {
        // 간이 요율: 가격 구간별 추정치
        const p = toNum(price);
        if (p <= 200000000) return p * 0.006;      // ≤2억: 0.6%
        if (p <= 600000000) return p * 0.005;      // ≤6억: 0.5%
        if (p <= 900000000) return p * 0.004;      // ≤9억: 0.4%
        return Math.min(p * 0.009, 20000000);      // >9억: 0.9%, 상한 간이 2천만원
      })();
      const stampTax = (() => {
        const p = toNum(price);
        if (p <= 100000000) return 20000;                 // ≤1억
        if (p <= 1000000000) return 50000;               // ≤10억
        return 150000;                                    // >10억
      })();
      const buyCost = toNum(brokerFee) + toNum(stampTax);
      const buyCostGrandTotal = toNum(acqTax) + toNum(buyCost);
      const sellCost = toNum(projectedSellPrice) * (toNum(sellCostPct)/100);

      // 손익(세전, 양도세 제외): 
      // 현금유출 = 보유자본(현금) + 대출이자(보유기간) + 취득세 + 매수부대비용 + (원금상환은 자산으로 전환되므로 유출에서 제외)
      // 보유 종료 시점 자산 = 매도금액 − 매도비용 − 대출잔액
      // 순손익 = (매도금액 − 매도비용 − 대출잔액) − (매수금액 + 취득세 + 매수부대비용) + 상환원금(자산 전환분)
      // 동치 정리: 매도금액 − 매도비용 − (매수금액 + 취득세 + 매수부대비용) − 대출잔액 + (상환원금) − (지급이자)
      // 여기서는 상환원금을 더하고, 지급이자를 뺀 형태로 계산
      // 요청: 보유기간 손익 = 단순 시세 차익 − (취득세 + 부대비용 + 이자)
      const pnl = toNum(simpleGain) - (toNum(acqTax) + toNum(buyCost) + toNum(interestPaid));
      const pnlPerMonth = monthsHeld > 0 ? (pnl / monthsHeld) : 0;

      // 표시
      setText('neededLoan', eokManWonFmt(neededLoan));
      setText('ltvCap', pfmt(ltvPct));
      setText('dsrCapMonthly', eokManWonFmt(dsrCapMonthly));
      setText('maxLoanAllowed', eokManWonFmt(maxLoanAllowed));
      setText('monthlyPayment', eokManWonFmt(monthlyPayment));
      setText('avgPrincipal', eokManWonFmt(avgPrincipal));
      setText('avgInterest', eokManWonFmt(avgInterest));
      setText('acqTax', eokManWonFmt(acqTax));
      setText('brokerFee', eokManWonFmt(brokerFee));
      setText('stampTax', eokManWonFmt(stampTax));
      setText('buyCostGrandTotal', eokManWonFmt(buyCostGrandTotal));
      setText('annualPropertyTax', eokManWonFmt(annualPropTax));
      setText('interestPaid', eokManWonFmt(interestPaid));
      setText('pnl', eokManWonFmt(pnl));
      setText('dbgSimpleGain', eokManWonFmt(simpleGain));
      setText('dbgAcq', eokManWonFmt(acqTax));
      setText('dbgBuyCost', eokManWonFmt(buyCost));
      setText('dbgInterest', eokManWonFmt(interestPaid));
      setText('dbgMonths', cfmt(monthsConsidered));
      setText('simpleGain', eokManWonFmt(simpleGain));

      setText('ltvMax', eokManWonFmt(ltvMax));
      setText('dsrMax', eokManWonFmt(dsrMax));
      const shortDiff = neededLoan - maxLoanAllowed;
      // 부족분은 음수로 보여주기 위해 부호 반전
      setText('shortCapital', signedEokManWon(-shortDiff, false));
      const gapLoan = maxLoanAllowed - neededLoan;
      setText('gap', signedEokManWon(gapLoan, true));
    }

    function setDefaults() {
      // 번동주공 60.33㎡ 예시 기본값
      document.getElementById('price').value = '41,000';
      document.getElementById('cash').value = '8000';
      document.getElementById('annualIncome').value = '4,750';
      
      document.getElementById('loanYears').value = '30';
      document.getElementById('annualRate').value = '3.95';
      document.getElementById('dsrLimitPct').value = '40';
      document.getElementById('existingMonthlyDebt').value = '0';
      document.getElementById('assessedRatioPct').value = '70';
      document.getElementById('holdingYears').value = '10';
      document.getElementById('annualAppreciationPct').value = '4';
      // 목표 매도가: 기본값 제거(빈 값 유지)
      document.getElementById('targetSellPrice').value = '';
      
    }

    function bindAutoCompute() {
      const ids = [
        'price','cash','annualIncome','loanYears','annualRate',
        'dsrLimitPct','existingMonthlyDebt','assessedRatioPct','holdingYears','annualAppreciationPct','targetSellPrice'
      ];
      ids.forEach(id => {
        document.getElementById(id).addEventListener('input', () => compute());
        document.getElementById(id).addEventListener('change', () => compute());
      });
      
      document.getElementById('btnCalc').addEventListener('click', compute);
    }

    setDefaults();
    bindAutoCompute();
    compute();
  </script>
</body>
</html>


